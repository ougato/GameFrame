{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\Script\\Core\\Manager_Deprecated\\Event/assets\\Script\\Core\\Manager_Deprecated\\Event\\ScriptEventManager.js"],"names":["ScriptNode","require","instance","ScriptEventManager","cc","Class","statics","getInstance","ctor","m_dictMsgList","getLastScriptNode","msgId","scriptNode","hasOwnProperty","scriptList","Utils","isArray","length","getFirstScriptNode","getScriptNodeIndex","script","index","i","findNode","isNull","getScript","_register1","lastNode","m_objPrevScript","m_objNextScript","push","_register2","msgIdList","register","param1","arguments","param2","isNumber","isObject","_unRegister1","firstNode","nextNode","prevNode","spliceNode","splice","destroy","getNext","_unRegister2","unRegister","onMessageEvent","data","warn","module","exports"],"mappings":"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","file":"ScriptEventManager.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\Script\\Core\\Manager_Deprecated\\Event","sourcesContent":["/**\r\n * 脚本事件 管理器\r\n * @type {Function}\r\n */\r\n\r\nlet ScriptNode = require( \"ScriptNode\" );\r\n\r\n// 实例化对象\r\nlet instance = null;\r\n\r\nlet ScriptEventManager = cc.Class({\r\n\r\n    /**\r\n     * 静态类\r\n     */\r\n    statics: {\r\n\r\n        /**\r\n         * 获取实例\r\n         * @returns {Function}\r\n         */\r\n        getInstance() {\r\n            if( instance === null ) {\r\n                instance = new ScriptEventManager();\r\n            }\r\n            return instance;\r\n        },\r\n    },\r\n\r\n    /**\r\n     * 构造\r\n     */\r\n    ctor() {\r\n        // 事件列表\r\n        this.m_dictMsgList = {};\r\n\r\n    },\r\n\r\n    /**\r\n     * 获取最后一个脚本节点\r\n     * @param msgId\r\n     * @returns {*}\r\n     */\r\n    getLastScriptNode( msgId ) {\r\n        let scriptNode = null;\r\n        if( this.m_dictMsgList.hasOwnProperty( msgId ) ) {\r\n            let scriptList = this.m_dictMsgList[msgId];\r\n            if( Utils.isArray( scriptList ) && scriptList.length > 0 ) {\r\n                scriptNode = scriptList[scriptList.length-1];\r\n            }\r\n        }\r\n        return scriptNode;\r\n    },\r\n\r\n    /**\r\n     * 获取第一个脚本节点\r\n     * @param msgId\r\n     * @returns {*}\r\n     */\r\n    getFirstScriptNode( msgId ) {\r\n        let scriptNode = null;\r\n        if( this.m_dictMsgList.hasOwnProperty( msgId ) ) {\r\n            let scriptList = this.m_dictMsgList[msgId];\r\n            if( Utils.isArray( scriptList ) && scriptList.length > 0 ) {\r\n                scriptNode = scriptList[0];\r\n            }\r\n        }\r\n        return scriptNode;\r\n    },\r\n\r\n    /**\r\n     * 获取脚本节点 在 数组里的下标\r\n     * @param msgId\r\n     * @param script\r\n     * @returns {number}\r\n     */\r\n    getScriptNodeIndex( msgId, script ) {\r\n        let index = -1;\r\n        if( this.m_dictMsgList.hasOwnProperty( msgId ) && Utils.isArray( this.m_dictMsgList[msgId] ) ) {\r\n            for( let i = 0; i < this.m_dictMsgList[msgId].length; ++i ) {\r\n                let findNode = this.m_dictMsgList[msgId][i];\r\n                if( !Utils.isNull( findNode ) && findNode.getScript() === script ) {\r\n                    index = i;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        return index;\r\n    },\r\n\r\n    /**\r\n     * 内部函数 注册事件_1\r\n     * @param msgId\r\n     * @param scriptNode\r\n     * @private\r\n     */\r\n    _register1( msgId, scriptNode ) {\r\n        if( this.m_dictMsgList.hasOwnProperty( msgId ) && Utils.isArray( this.m_dictMsgList[msgId] ) ) {\r\n            let lastNode = getLastScriptNode( msgId );\r\n            if( !Utils.isNull( lastNode ) ) {\r\n                scriptNode.m_objPrevScript = lastNode;\r\n                scriptNode.m_objNextScript = null;\r\n                lastNode.m_objNextScript = scriptNode;\r\n            }\r\n        } else {\r\n            // msgId 在字典中不存在\r\n            this.m_dictMsgList[msgId] = [];\r\n        }\r\n        this.m_dictMsgList[msgId].push( scriptNode );\r\n    },\r\n\r\n    /**\r\n     * 内部函数 注册事件_2\r\n     * @param script\r\n     * @param msgIdList\r\n     * @private\r\n     */\r\n    _register2( script, msgIdList ) {\r\n        for( let i = 0; i < msgIdList.length; ++i ) {\r\n            let scriptNode = new ScriptNode( script );\r\n            this._register1( msgIdList[i], scriptNode );\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 注册 消息事件\r\n     * （注：通过参数类型来重载注册函数）\r\n     * 一、通过消息ID，注册事件\r\n     * 参数1 number 消息ID\r\n     * 参数2 object 事件节点\r\n     *\r\n     * 二、在脚本对象内，注册多个消息ID\r\n     * 参数1 object 脚本对象\r\n     * 参数2 array 消息ID数组\r\n     */\r\n    register() {\r\n        // 参数\r\n        // [ 0.可变参数 1.可变参数 ]\r\n        let param1 = arguments[0];\r\n        let param2 = arguments[1];\r\n\r\n        if( Utils.isNumber( param1 ) && Utils.isObject( param2 ) ) {\r\n            this._register1( param1, param2 );\r\n        } else if( Utils.isObject( param1 ) && Utils.isArray( param2 ) ) {\r\n            this._register2( param2, param2 );\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 内部函数 删除注册事件_1\r\n     * @param msgId\r\n     * @param script\r\n     * @private\r\n     */\r\n    _unRegister1( msgId, script ) {\r\n        if( this.m_dictMsgList.hasOwnProperty( msgId ) && Utils.isArray( this.m_dictMsgList[msgId] ) ) {\r\n            let firstNode = this.getFirstScriptNode( msgId );\r\n            let nextNode = firstNode;\r\n            while( !Utils.isNull( nextNode ) ) {\r\n                if( nextNode.getScript() === script ) {\r\n                    let index = this.getScriptNodeIndex( script );\r\n                    if( index >= 0 ) {\r\n                        let prevNode = script.m_objPrevScript;\r\n                        prevNode.m_objNextScript = script.m_objNextScript;\r\n                        let nextNode = script.m_objNextScript;\r\n                        nextNode.m_objPrevScript = script.m_objPrevScript;\r\n                        let spliceNode = this.m_dictMsgList[msgId].splice( index, 1 );\r\n                        spliceNode.destroy();\r\n                    }\r\n                    break;\r\n                }\r\n                nextNode = nextNode.getNext();\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 内部函数 删除注册事件_2\r\n     * @param script\r\n     * @param msgIdList\r\n     * @private\r\n     */\r\n    _unRegister2( script, msgIdList ) {\r\n        for( let i = 0; i < msgIdList.length; ++i ) {\r\n            this._unRegister1( msgIdList[i], script );\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 卸载注册 消息事件\r\n     * （注：通过参数类型来重载注册函数）\r\n     * 一、通过消息ID，注册事件\r\n     * 参数1 number 消息ID\r\n     * 参数2 object 事件节点\r\n     *\r\n     * 二、在脚本对象内，注册多个消息ID\r\n     * 参数1 object 脚本对象\r\n     * 参数2 array 消息ID数组\r\n     */\r\n    unRegister() {\r\n        // 参数\r\n        // [ 0.可变参数 1.可变参数 ]\r\n        let param1 = arguments[0];\r\n        let param2 = arguments[1];\r\n\r\n        if( Utils.isNumber( param1 ) && Utils.isObject( param2 ) ) {\r\n            this._unRegister1( param1, param2 );\r\n        } else if( Utils.isObject( param1 ) && Utils.isArray( param2 ) ) {\r\n            this._unRegister2( param2, param2 );\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 接收 消息 监听函数\r\n     * @param msgId\r\n     * @param data\r\n     */\r\n    onMessageEvent( msgId, data ) {\r\n        if( this.m_dictMsgList.hasOwnProperty( msgId ) ) {\r\n\r\n        } else {\r\n            cc.warn( \"未找到消息 [\" + msgId + \"]\" );\r\n        }\r\n    },\r\n\r\n});\r\n\r\nmodule.exports = ScriptEventManager;"]}